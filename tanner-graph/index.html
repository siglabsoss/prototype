<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="3rd/d3.min.js"></script>
    <script type="text/javascript" src="3rd/jquery-2.1.0.min.js"></script>
</head>
<body>
    <div id="viz"></div>
    <script type="text/javascript">

    // Globals, go cry about it

    var bitY = 75; // vertical spacing between nodes
    var bitX = 50;
    var checkY = 100; // vertical spacing between nodes
    var checkX = 250;

    var bitNodes = 7;
    var checkNodes = 3;

    function getBitCoords(index)
    {
        return [bitX, bitY + index*bitY];
    }

    function getCheckCoords(index)
    {
        var offset = checkNodes * checkY/2;
        return [checkX, offset + index*checkY];
    }

    function newBitNode(sampleSVG, index)
    {
        
        var pos = getBitCoords(index);
        var x = pos[0];
        var y = pos[1];
        

        sampleSVG.append("circle")
        .style("stroke", "gray")
        .style("fill", "white")
        .attr("r", 25)
        .attr("cx", x)
        .attr("cy", y);
        // .on("mouseover", function(){d3.select(this).style("fill", "aliceblue");})
        // .on("mouseout", function(){d3.select(this).style("fill", "white");});

        // bitY += 75;
    }

    function newCheckNode(sampleSVG, index)
    {
        var pos = getCheckCoords(index);
        var x = pos[0];
        var y = pos[1];

        sampleSVG.append("rect")
         .attr("x", x)
         .attr("y", y)
        .attr("width", 45)
        .attr("height", 45)
        .style("stroke", "gray")
        .style("fill", "gray");

    }

    function parseMatrix()
    {
        var $textarea = $('#matrixtext');
        var mat = JSON.parse($textarea.val());

        var m = mat.length;
        var n = mat[0].length;
        var k = n-m;

        console.log("Matrix is sized " + m + " x " + n + " (M * N)");
        console.log("Ldpc notation is (" + n + ", " + k + ")");
        console.log("Matrix k is " + k);

        bitNodes = n;
        checkNodes = m;


        $.each(mat, function( rowIndex, row ) {

            if( row.length != n )
                alert("matrix row " + rowIndex + " has length " + row.length + " which doesn't match " + n);

            
        });

        console.log(m);

        drawGraph(m,n,k);
    }

    function drawGraph(m,n,k)
    {
        $('#viz').html('');
        var sampleSVG = d3.select("#viz")
        .append("svg")
        .attr("width", 400)
        .attr("height", Math.max(bitNodes,checkNodes)*100);    

        for( i = 0; i < bitNodes; i++ )
        {
            newBitNode(sampleSVG, i);        
        }

        for( i = 0; i < checkNodes; i++ )
        {
            newCheckNode(sampleSVG, i);        
        }


    }

    drawGraph();




    </script>
    <textarea id="matrixtext" rows="4" cols="40">
[[1,0,0,0,1,1,1],
[0,1,0,1,0,1,1],
[0,0,1,1,1,0,1]]
    </textarea>
    <br><button onClick="parseMatrix()" type="button">go</button>
</body>
</html>